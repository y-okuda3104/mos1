# mos1 - 居酒屋 POS 注文システム

## 概要
居酒屋向けの客側タッチパネル注文システムのフロントエンド実装です。  
客がメニューを検索・選択してカートに入れ、注文確定から配膳状況まで管理できるシステムです。

**バージョン**: 2.0.0  
**対応ブラウザ**: Chrome, Firefox, Safari, Edge（最新版）  
**UI設計**: Apple HIG準拠、WCAG 2.1 AA対応

## 主な機能

### 🏠 トップメニュー（top_menu.html）
- **店舗情報表示**：店舗名、座席ID、ラストオーダー時刻、リアルタイム時刻
- **座席管理システム**：英字1文字-2桁形式（A-01, C-05, B-12など）での座席選択
- **スタッフ呼び出し機能**：
  - 30秒クールダウン機能付き
  - 確認モーダル＆完了通知システム
  - 呼び出し失敗時の再試行機能
- **LO時間管理**：サーバー連携またはローカル計算による自動更新

### 🍽️ メニュー一覧（menu_list.html）
- **メニュー表示システム**：
  - API未応答時は12品のダミーメニューを自動表示
  - レスポンシブグリッドレイアウト（デスクトップ2列、モバイル1列）
  - 売切れ商品の視覚的区別
- **高度な検索・絞込機能**：
  - リアルタイムキーワード検索（デバウンス機能付き）
  - **タブ形式カテゴリ選択**：Chromeライクなタブ表示でカテゴリ切り替え
- **カート管理システム**：
  - 商品追加・削除・数量調整（+/-ボタン）
  - 座席単位でのlocalStorage永続化
  - リアルタイム合計金額計算
  - 折り畳み式詳細表示
- **注文・配膳管理**：
  - ワンクリック注文確定
  - 配膳済み/未配膳ステータスの独立管理
  - 複数座席対応（座席別履歴保存）

## 🎨 UI/UXデザイン仕様

### コンパクトヘッダー設計
- **省スペース化**：ヘッダー高さを最小限に抑制してメニュー表示領域を最大化
- **情報密度最適化**：店舗名・座席・LO時間を横並び表示で縦幅削減

### カテゴリ選択UI
- **タブインターフェース**：従来のプルダウンからタブ形式に変更
- **視認性向上**：アクティブタブの明確な視覚的区別
- **レスポンシブタブ**：モバイルでの横スクロール対応

## 🏗️ 技術アーキテクチャ

### フロントエンド技術スタック
- **HTML5**: セマンティックマークアップ、構造化データ
- **CSS3**: CSS Grid、Flexbox、CSS Variables、アニメーション
- **JavaScript（ES6+）**: 
  - モジュールパターン
  - async/await による非同期処理
  - デバウンス・スロットリング最適化
  - エラーハンドリングとフォールバック

### データ管理
- **localStorage**: 座席別データ永続化
- **座席ID規則**: `[A-Z]-\d{2}`正規表現バリデーション
- **キー命名規則**:
  - `seatId`: 現在選択座席
  - `cart_[座席ID]`: 座席別カート
  - `orders_[座席ID]`: 座席別注文履歴

### 状態管理パターン
```javascript
// 状態管理の例
const state = {
  seatId: null,
  cart: {},
  orders: [],
  isLoading: false
};
```

## 📁 ファイル構成

```
mos1-main/
├── README.md              # このファイル
├── top_menu.html          # トップメニュー画面
├── top_menu.css           # トップメニューのスタイル
├── top_menu.js            # トップメニューロジック
├── menu_list.html         # メニュー一覧画面  
├── menu_list.css          # メニュー一覧スタイル
├── menu_list.js           # メニュー一覧ロジック
└── api.js                 # API連携ユーティリティ（実装予定）
```

### コード品質
- **ESLint準拠**: 一貫したコーディング規約
- **関数型アプローチ**: 純粋関数と不変性の重視
- **エラー境界**: try-catch文による堅牢なエラーハンドリング
- **パフォーマンス最適化**: デバウンス、メモ化、遅延読み込み

## 🏪 座席管理システム

### 座席ID規則
| 座席タイプ | ID形式 | 範囲 | 説明 |
|-----------|--------|------|------|
| カウンター席 | C-01〜C-10 | 10席 | カウンター沿いの座席 |
| 1階テーブル | A-01〜A-05 | 5テーブル | 1階フロアのテーブル席 |
| 2階テーブル | B-01〜B-15 | 15テーブル | 2階フロアのテーブル席 |

### データ永続化
```javascript
// localStorage キー構造
localStorage['seatId']              // 現在座席: "C-05"
localStorage['cart_C-05']           // C-05のカート
localStorage['orders_C-05']         // C-05の注文履歴
```

## 🔌 API仕様（実装予定）

### エンドポイント
| メソッド | エンドポイント | 説明 |
|----------|----------------|------|
| GET | `/api/menu?storeId={id}` | メニュー一覧取得 |
| GET | `/api/lo` | ラストオーダー情報取得 |
| POST | `/api/call` | スタッフ呼び出し |

### レスポンス例
```javascript
// メニューAPI レスポンス
{
  "items": [
    {
      "id": "m01",
      "name": "から揚げ",
      "price": 580,
      "category": "揚げ物",
      "imageUrl": "/images/menu/m01.jpg",
      "recommend": 85,
      "quickOrder": 3,
      "soldOut": false
    }
  ]
}

// ラストオーダーAPI レスポンス
{
  "remainingMinutes": 90,
  "loTime": "23:30",
  "notify": false
}
```

### エラーハンドリング
- **タイムアウト**: 10秒でリクエスト中断
- **フォールバック**: API失敗時はダミーデータ表示
- **リトライ**: 指数バックオフによる再試行

## 🛠️ 開発・デバッグ

### 最新の変更点（v2.1）
1. **ヘッダーコンパクト化**：縦幅を約40%削減
2. **タブ形式カテゴリ**：プルダウンからタブUIに変更
3. **並び順機能削除**：UIの簡素化とパフォーマンス向上

### デバッグコマンド
```javascript
// ブラウザコンソール（F12 > Console）で実行可能

// 配膳状態を手動変更
window.markDelivered('m01');

// 注文履歴確認
console.log(localStorage.getItem('orders_C-05'));

// 全データリセット
localStorage.clear();

// カート状態確認
console.log(JSON.parse(localStorage.getItem('cart_C-05')));
```

### 開発環境セットアップ
```bash
# ローカルサーバー起動（例：Live Server）
npx serve .

# または Python簡易サーバー
python -m http.server 8080
```

### テストケース
1. **座席選択**: 全座席タイプの正常動作確認
2. **メニュー検索**: キーワード・カテゴリ・ソート機能
3. **カート操作**: 追加・削除・数量変更・永続化
4. **注文フロー**: 注文確定から配膳完了まで
5. **レスポンシブ**: 各画面サイズでの表示確認

## 📊 パフォーマンス最適化

### 実装済み最適化
- **デバウンス**: 検索入力300ms遅延
- **仮想スクロール**: 大量メニュー対応（未実装）
- **画像遅延読み込み**: `loading="lazy"` 属性
- **CSS最適化**: Critical Path CSS、アニメーション最適化

### メトリクス目標
- **初回読み込み**: < 2秒
- **インタラクション応答**: < 100ms
- **メモリ使用量**: < 50MB

## 🔒 セキュリティ

### XSS対策
```javascript
// HTML エスケープ関数
utils.escapeHtml(userInput)  // 実装済み
```

### データ検証
- **座席ID**: 正規表現による形式検証
- **入力値**: サニタイゼーション処理
- **localStorage**: 容量制限チェック


## 🚀 今後の拡張予定（現行プロジェクト範囲内）
### Phase 2（短期）
- [ ] 注文履歴画面のUI改善
- [ ] 会計QRコード表示機能の追加
- [ ] スタッフ呼び出し機能の安定化（再試行・通知強化）
- [ ] メニュー管理画面（管理者向け）の追加

### Phase 3（中期）
- [ ] レジシステムとのAPI連携（会計処理）
- [ ] ラストオーダー通知のサーバ連携強化
- [ ] 多言語対応（日本語・英語）

---

## 💡 参考構想（将来的な検討事項）
※現行プロジェクトの要件には含まれません
- PWA対応（オフライン注文）
- リアルタイム同期（WebSocket）
- AIによるおすすめメニュー表示

## 🐛 既知の問題・制限事項

### 現在の制限
- [ ] 配膳完了の自動反映（手動デバッグ関数のみ）
- [ ] 支払い処理・レジ連携
- [ ] リアルタイム在庫管理
- [ ] 複数デバイス間同期

### ブラウザ互換性
- **推奨**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **制限**: IE11 非対応
- **モバイル**: iOS 14+, Android 10+


### 開発チーム
- **プロジェクト管理**: 
- **技術サポート**: 
- **UI/UX**: 

### 報告・要望
1. **バグ報告**: コンソールログと再現手順を添付
2. **機能要望**: 優先度と業務影響を明記
3. **パフォーマンス**: DevTools パフォーマンス情報を添付

---

**最終更新**: 2024年12月  
**ライセンス**: 
**バージョン管理**: Git による履歴管理
