# mos1 - 居酒屋 POS 注文システム（PHP版）

## 概要
居酒屋向けの客側タッチパネル注文システムのPHP実装版です。  
客がメニューを検索・選択してカートに入れ、注文確定から配膳状況まで管理できるシステムです。

**バージョン**: 2.0.0 (PHP版)  
**対応ブラウザ**: Chrome, Firefox, Safari, Edge（最新版）  
**UI設計**: Apple HIG準拠、WCAG 2.1 AA対応  
**サーバー要件**: PHP 7.4以上

## 変更点（HTML/JSからPHPへの移行）

### アーキテクチャの変更
- **言語**: HTML/JavaScript → PHP
- **状態管理**: localStorage → PHPセッション
- **データ処理**: クライアントサイド → サーバーサイド
- **UIレンダリング**: JavaScriptによる動的生成 → PHPによるサーバーサイドレンダリング

### 機能の維持
以下の機能は完全に維持されています：
- ✅ デザイン（CSS）は完全に同じ
- ✅ 表示内容は完全に同じ
- ✅ ユーザー操作は完全に同じ
- ✅ 座席管理機能
- ✅ メニュー検索・フィルタリング
- ✅ カート管理
- ✅ 注文履歴
- ✅ スタッフ呼び出し
- ✅ ラストオーダー時間表示

## 主な機能

### 🏠 トップメニュー（top_menu.php）
- **店舗情報表示**：店舗名、座席ID、ラストオーダー時刻、リアルタイム時刻
- **座席管理システム**：英字1文字-2桁形式（A-01, C-05, B-12など）での座席選択
- **スタッフ呼び出し機能**：
  - 30秒クールダウン機能付き
  - 確認モーダル＆完了通知システム
  - 呼び出し失敗時の再試行機能
- **LO時間管理**：PHPによるサーバーサイド計算

### 🍽️ メニュー一覧（menu_list.php）
- **メニュー表示システム**：
  - PHPによる12品のダミーメニュー生成
  - レスポンシブグリッドレイアウト（デスクトップ2列、モバイル1列）
  - 売切れ商品の視覚的区別
- **高度な検索・絞込機能**：
  - サーバーサイドキーワード検索
  - タブ形式カテゴリ選択
- **カート管理システム**：
  - 商品追加・削除・数量調整（+/-ボタン）
  - 座席単位でのPHPセッション永続化
  - リアルタイム合計金額計算
  - 折り畳み式詳細表示
- **注文・配膳管理**：
  - ワンクリック注文確定
  - 配膳済み/未配膳ステータスの独立管理
  - 複数座席対応（座席別セッション管理）

### 📋 注文履歴（order_history.php）
- **注文一覧表示**：時系列での注文履歴表示
- **配膳状態管理**：配膳済み/未配膳の切り替え
- **フィルタリング**：全て/未配膳/配膳済みでのフィルター
- **履歴削除**：注文履歴のクリア機能

## 🏗️ 技術アーキテクチャ

### バックエンド技術スタック
- **PHP 7.4+**: サーバーサイドロジック
- **セッション管理**: PHPセッションによる状態管理
- **データ永続化**: セッション変数によるカート・注文履歴の保存

### フロントエンド技術スタック
- **HTML5**: セマンティックマークアップ、構造化データ
- **CSS3**: CSS Grid、Flexbox、CSS Variables、アニメーション（既存CSSをそのまま使用）
- **JavaScript（ES6+）**: 
  - 最小限のクライアントサイドロジック
  - Fetch APIによる非同期通信
  - リアルタイム時刻表示

### データ管理
- **PHPセッション**: 座席別データ永続化
- **座席ID規則**: `[A-Z]-\d{2}`正規表現バリデーション
- **セッションキー命名規則**:
  - `seatId`: 現在選択座席
  - `cart_[座席ID]`: 座席別カート
  - `orders_[座席ID]`: 座席別注文履歴

## 📁 ファイル構成

```
mos1/
├── README.md                      # このファイル
├── index.php                      # エントリーポイント
├── top_menu.php                   # トップメニュー画面
├── top_menu.css                   # トップメニューのスタイル
├── top_menu.js                    # （削除予定）
├── menu_list.php                  # メニュー一覧画面
├── menu_list.css                  # メニュー一覧スタイル
├── menu_list.js                   # （削除予定）
├── order_history.php              # 注文履歴画面
├── order_history.css              # 注文履歴スタイル
├── order_history.js               # （削除予定）
├── top_page.php                   # リダイレクト用
└── includes/
    ├── session.php                # セッション管理
    └── functions.php              # 共通関数
```

## 🚀 セットアップ方法

### 前提条件
- PHP 7.4以上がインストールされていること
- Webサーバー（Apache、Nginx、またはPHP組み込みサーバー）

### インストール手順

1. **リポジトリのクローン**
```bash
git clone https://github.com/y-okuda3104/mos1.git
cd mos1
```

2. **PHPサーバーの起動**

#### PHP組み込みサーバーを使用する場合：
```bash
php -S localhost:8000
```

#### Apacheを使用する場合：
```bash
# DocumentRootにプロジェクトを配置
# 例: /var/www/html/mos1/
```

3. **ブラウザでアクセス**
```
http://localhost:8000
```

## 📝 使用方法

### 基本的な操作フロー

1. **座席の設定**
   - トップメニューで「座席変更」ボタンをクリック
   - 座席を選択して「設定」をクリック

2. **メニューの注文**
   - 「メニュー一覧」をクリック
   - カテゴリや検索で商品を探す
   - 「追加」ボタンでカートに追加
   - カートの「表示」ボタンで内容を確認
   - 「注文確定」で注文

3. **注文履歴の確認**
   - 「注文履歴」をクリック
   - 配膳状態を確認・変更可能

4. **スタッフ呼び出し**
   - トップメニューで「スタッフ呼び出し」をクリック
   - 確認画面で「呼び出す」をクリック

## 🔧 カスタマイズ

### 設定変更（includes/functions.php）
```php
// 店舗名
define('STORE_NAME', 'みどり亭 本店');

// 閉店時間
define('STORE_CLOSE_HOUR', 24);
define('STORE_CLOSE_MINUTE', 0);

// ラストオーダー時間（閉店前の分数）
define('LO_MINUS_MINUTES', 30);
```

### メニューデータのカスタマイズ
`includes/functions.php`の`generateDummyMenu()`関数を編集してメニューを変更できます。

### CSSのカスタマイズ
既存の`.css`ファイルを編集することで、デザインをカスタマイズできます。

## 🛡️ セキュリティ

- **XSS対策**: すべての出力で`htmlspecialchars()`を使用
- **CSRF対策**: 今後の実装予定
- **SQLインジェクション対策**: 現在はデータベース未使用（セッションのみ）
- **入力検証**: 座席IDなどの入力値を正規表現で検証

## 🔮 今後の拡張予定

- [ ] データベース連携（MySQL/PostgreSQL）
- [ ] 実際のAPI実装
- [ ] 管理画面の追加
- [ ] 画像アップロード機能
- [ ] 売上レポート機能
- [ ] 多言語対応

## 📄 ライセンス

Copyright &copy; 2024 みどり亭 POS システム

## 🤝 貢献

プルリクエストを歓迎します。大きな変更の場合は、まずissueを開いて変更内容を議論してください。

## 📞 サポート

問題が発生した場合は、GitHubのIssueセクションで報告してください。
